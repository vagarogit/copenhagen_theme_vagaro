import{j as e,F as n,L as s,S as t,H as a,I as r,M as o,r as l,u as i,a as c,N as u,T as d,C as p,s as m,b as h,c as j,d as f,e as b,f as g,O as x,g as v,h as y,i as w,D as k,k as q,l as _,m as C,P as S,A as T,n as F,o as I,p as P,q as R,t as $,v as L,w as E,x as D,y as M,z,B as G,W as V,E as A,G as H,J as X,K as N,Q as O,R as U,U as B,V as W,X as K,Y,Z as J,_ as Z,$ as Q,a0 as ee,a1 as ne,a2 as se,a3 as te,a4 as ae,a5 as re}from"shared";function oe({field:l,onChange:i}){const{label:c,error:u,value:d,name:p,required:m,description:h,type:j}=l,f={},b="integer"===j||"decimal"===j?"number":"text";"integer"===j&&(f.step="1"),"decimal"===j&&(f.step="any");const g="anonymous_requester_email"===j?"email":void 0;return e.jsxs(n,{children:[e.jsxs(s,{children:[c,m&&e.jsx(t,{"aria-hidden":"true",children:"*"})]}),h&&e.jsx(a,{dangerouslySetInnerHTML:{__html:h}}),e.jsx(r,{name:p,type:b,defaultValue:d,validation:u?"error":void 0,required:m,onChange:e=>{i&&i(e.target.value)},autoComplete:g,...f}),u&&e.jsx(o,{validation:"error",children:u})]})}const le=m(n)`
  .ck.ck-editor {
    margin-top: ${e=>e.theme.space.xs};
  }
`,ie=m(o)`
  .ck.ck-editor + & {
    margin-top: ${e=>e.theme.space.xs};
  }
`;function ce({field:n,hasWysiwyg:r,baseLocale:o,hasAtMentions:m,userRole:j,brandId:f,onChange:b}){const{label:g,error:x,value:v,name:y,required:w,description:k}=n,q=function({hasWysiwyg:n,baseLocale:s,hasAtMentions:t,userRole:a,brandId:r}){const o=l.useRef(!1),{addToast:m}=i(),{t:h}=c();return l.useCallback((async l=>{if(n&&l&&!o.current){o.current=!0;const{createEditor:n}=await import("@zendesk/help-center-wysiwyg");(await n(l,{editorType:"supportRequests",hasAtMentions:t,userRole:a,brandId:r,baseLocale:s})).plugins.get("Notification").on("show",((n,s)=>{n.stop();const t=s.message instanceof Error?s.message.message:s.message,{type:a,title:r}=s;m((({close:n})=>e.jsxs(u,{type:a,children:[e.jsx(d,{children:r}),t,e.jsx(p,{"aria-label":h("new-request-form.close-label","Close"),onClick:n})]})))}))}}),[n,s,t,a,r,m,h])}({hasWysiwyg:r,baseLocale:o,hasAtMentions:m,userRole:j,brandId:f});return e.jsxs(le,{children:[e.jsxs(s,{children:[g,w&&e.jsx(t,{"aria-hidden":"true",children:"*"})]}),k&&e.jsx(a,{dangerouslySetInnerHTML:{__html:k}}),e.jsx(h,{ref:q,name:y,defaultValue:v,validation:x?"error":void 0,required:w,onChange:e=>b(e.target.value),rows:6,isResizable:!0}),x&&e.jsx(ie,{validation:"error",children:x})]})}function ue(){const{t:n}=c();return e.jsxs(e.Fragment,{children:[e.jsx(t,{"aria-hidden":"true",children:"-"}),e.jsx(t,{hidden:!0,children:n("new-request-form.dropdown.empty-option","Select an option")})]})}function de({field:n,onChange:s}){const{label:a,options:r,error:o,value:i,name:c,required:u,description:d}=n,p=null==i?"":i.toString(),m=l.useRef(null);return l.useEffect((()=>{if(m.current&&u){const e=m.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[m,u]),e.jsxs(j,{children:[e.jsxs(f,{children:[a,u&&e.jsx(t,{"aria-hidden":"true",children:"*"})]}),d&&e.jsx(b,{dangerouslySetInnerHTML:{__html:d}}),e.jsxs(g,{ref:m,inputProps:{name:c,required:u},isEditable:!1,validation:o?"error":void 0,inputValue:p,selectionValue:p,renderValue:({selection:n})=>n?.label||e.jsx(ue,{}),onChange:({selectionValue:e})=>{void 0!==e&&s(e)},children:[!u&&e.jsx(x,{value:"",label:"-",children:e.jsx(ue,{})}),r.map((n=>e.jsx(x,{value:n.value.toString(),label:n.name},n.value)))]}),o&&e.jsx(v,{validation:"error",children:o})]})}function pe({field:r,onChange:i}){const{label:c,error:u,value:d,name:p,required:m,description:h}=r,[j,f]=l.useState(d);return e.jsxs(n,{children:[e.jsx("input",{type:"hidden",name:p,value:"off"}),e.jsxs(y,{name:p,required:m,defaultChecked:d,value:j?"on":"off",onChange:e=>{const{checked:n}=e.target;f(n),i(n)},children:[e.jsxs(s,{children:[c,m&&e.jsx(t,{"aria-hidden":"true",children:"*"})]}),h&&e.jsx(a,{dangerouslySetInnerHTML:{__html:h}})]}),u&&e.jsx(o,{validation:"error",children:u})]})}const me="[]";function he(e){return`[${e.join("::")}]`}function je(e){return e.startsWith("[")&&e.endsWith("]")}function fe(e){const n=he(e.slice(0,-1));return{type:"SubGroup",name:e[e.length-1],backOption:{type:"previous",label:"Back",value:n},options:[]}}function be({options:e,hasEmptyOption:n}){const s=l.useMemo((()=>function(e,n){const s={[me]:{type:"RootGroup",options:n?[{label:"-",value:""}]:[]}};return e.forEach((e=>{const{name:n,value:t}=e;if(n.includes("::")){const[e,a]=function(e){const n=e.split("::");return[n.slice(0,-1),n.slice(-1)[0]]}(n),r=he(e);s[r]||(s[r]=fe(e)),s[r]?.options.push({value:t,label:n.split("::").join(" > "),menuLabel:a});for(let n=0;n<e.length;n++){const t=e.slice(0,n),a=e.slice(0,n+1),r=he(t),o=he(a);s[r]||(s[r]=fe(t)),void 0===s[r]?.options.find((e=>e.value===o))&&s[r]?.options.push({type:"next",label:a[a.length-1],value:o})}}else s[me].options.push({value:t,label:n})})),s}(e,n)),[e,n]),[t,a]=l.useState(function(e){const n={type:"RootGroup",options:[]};return Object.values(e).forEach((({options:e})=>{n.options.push(...e.filter((({type:e})=>void 0===e)))})),n}(s));l.useEffect((()=>{a(s[me])}),[s]);return{currentGroup:t,isGroupIdentifier:je,setCurrentGroupByIdentifier:e=>{const n=s[e];n&&a(n)}}}function ge({field:n}){const{label:s,options:a,error:r,value:o,name:i,required:c,description:u}=n,{currentGroup:d,isGroupIdentifier:p,setCurrentGroupByIdentifier:m}=be({options:a,hasEmptyOption:!1}),[h,y]=l.useState(o||[]),k=l.useRef(null);l.useEffect((()=>{if(k.current&&c){const e=k.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[k,c]);return e.jsxs(j,{children:[h.map((n=>e.jsx("input",{type:"hidden",name:`${i}[]`,value:n},n))),e.jsxs(f,{children:[s,c&&e.jsx(t,{"aria-hidden":"true",children:"*"})]}),u&&e.jsx(b,{dangerouslySetInnerHTML:{__html:u}}),e.jsxs(g,{ref:k,isMultiselectable:!0,inputProps:{required:c},isEditable:!1,validation:r?"error":void 0,onChange:e=>{if(Array.isArray(e.selectionValue)){const n=e.selectionValue.slice(-1).toString();p(n)?m(n):y(e.selectionValue)}},selectionValue:h,maxHeight:"auto",children:["SubGroup"===d.type&&e.jsx(x,{...d.backOption}),"SubGroup"===d.type?e.jsx(w,{"aria-label":d.name,children:d.options.map((n=>e.jsx(x,{...n,children:n.menuLabel??n.label},n.value)))}):d.options.map((n=>e.jsx(x,{...n},n.value)))]}),r&&e.jsx(v,{validation:"error",children:r})]})}const xe="return-focus-to-ticket-form-field";function ve({field:n,newRequestPath:s}){const t=l.createRef();return l.useEffect((()=>{sessionStorage.getItem(xe)&&(sessionStorage.removeItem(xe),t.current?.firstChild?.focus())}),[]),e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"hidden",name:n.name,value:n.value}),n.options.length>1&&e.jsxs(j,{children:[e.jsx(f,{children:n.label}),e.jsx(g,{isEditable:!1,onChange:({selectionValue:e})=>{if(e&&"number"==typeof e){const n=new URL(window.location.href);n.searchParams.set("ticket_form_id",e),sessionStorage.setItem(xe,"true"),window.location.assign(`${s}${n.search}`)}},ref:t,children:n.options.map((s=>e.jsx(x,{value:s.value,label:s.name,isSelected:n.value===s.value,children:s.name},s.value)))})]})]})}function ye({field:n}){const{value:s,name:t}=n;return e.jsx("input",{type:"hidden",name:t,value:s})}function we(e){const n=l.useRef(!1),s=l.useRef(!1);return{formRefCallback:l.useCallback((t=>{t&&!n.current&&(n.current=!0,t.submit=async()=>{if(!1===s.current){s.current=!0;const n=await async function(){const e=await fetch("/api/v2/help_center/sessions.json"),{current_session:n}=await e.json();return n.csrf_token}(),a=document.createElement("input");a.type="hidden",a.name="authenticity_token",a.value=n,t.appendChild(a);const r=e.filter((e=>"partialcreditcard"===e.type));for(const e of r){const n=t.querySelector(`input[name="${e.name}"]`);n&&n instanceof HTMLInputElement&&4===n.value.length&&(n.value=`XXXXXXXXX${n.value}`)}HTMLFormElement.prototype.submit.call(t)}})}),[e]),handleSubmit:e=>{e.preventDefault(),e.target.submit()}}}const ke=2048,qe="tf_",_e=["true","false"],Ce=["pre","strong","b","p","blockquote","ul","ol","li","h2","h3","h4","i","em","br"];function Se(e,n){if(!Number.isNaN(Number(e))){const s=`request[custom_fields][${e}]`;return n.ticketFields.find((e=>e.name===s))}switch(e){case"anonymous_requester_email":return n.emailField;case"due_at":return n.dueDateField;case"collaborators":return n.ccField;case"organization_id":return n.organizationField;default:return n.ticketFields.find((n=>n.name===`request[${e}]`))}}function Te({ticketFields:e,ccField:n,dueDateField:s,emailField:t,organizationField:a}){return l.useMemo((()=>function(e){const{href:n}=location,s=new URL(n).searchParams,t={...e,ticketFields:[...e.ticketFields]};if(n.length>ke)return e;if(s.get("parent_id"))return e;for(const[a,r]of s){if(!a.startsWith(qe))continue;const e=Se(a.substring(qe.length),t);if(!e)continue;const n=k.sanitize(r,{ALLOWED_TAGS:Ce});switch(e.type){case"partialcreditcard":continue;case"multiselect":e.value=n.split(",").filter((n=>e.options.some((e=>e.value===n))));break;case"checkbox":_e.includes(n)&&(e.value="true"===n?"on":"false"===n?"off":"");break;default:e.value=n}}return t}({ticketFields:e,ccField:n,dueDateField:s,emailField:t,organizationField:a})),[e,n,s,t,a])}const Fe=m.div`
  flex: 1;
`;function Ie({file:n,onRemove:s}){const{t:t}=c(),a=e=>{"Enter"!==e.code&&"Space"!==e.code&&"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),s())},r="pending"===n.status?n.file_name:n.value.file_name,o=t("new-request-form.attachments.stop-upload","Stop upload"),l=t("new-request-form.attachments.remove-file","Remove file");return e.jsx(q.Item,{children:e.jsx(_,{type:"generic",title:r,onKeyDown:e=>{"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),s())},children:"pending"===n.status?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:r}),e.jsx(C,{content:o,children:e.jsx(_.Close,{"aria-label":o,onClick:()=>{s()},onKeyDown:a})}),e.jsx(S,{value:n.progress,"aria-label":t("new-request-form.attachments.uploading","Uploading {{fileName}}",{fileName:r})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsx(T,{isExternal:!0,href:n.value.url,target:"_blank",children:r})}),e.jsx(C,{content:l,children:e.jsx(_.Delete,{"aria-label":l,onClick:()=>{s()},onKeyDown:a})}),e.jsx(S,{value:100,"aria-hidden":"true"})]})})})}async function Pe(){const e=await fetch("/api/v2/users/me.json"),{user:{authenticity_token:n}}=await e.json();return n}function Re({field:t}){const{label:a,error:m,name:h,attachments:j}=t,{files:f,addPendingFile:b,setPendingFileProgress:g,setUploaded:x,removePendingFile:v,removeUploadedFile:y}=function(e){const[n,s]=l.useState(e);return{files:n,addPendingFile:l.useCallback(((e,n,t)=>{s((s=>[...s,{status:"pending",id:e,file_name:n,progress:0,xhr:t}]))}),[]),setPendingFileProgress:l.useCallback(((e,n)=>{s((s=>s.map((s=>"pending"===s.status&&s.id===e?{...s,progress:n}:s))))}),[]),removePendingFile:l.useCallback((e=>{s((n=>n.filter((n=>"pending"!==n.status||n.id!==e))))}),[]),removeUploadedFile:l.useCallback((e=>{s((n=>n.filter((n=>"uploaded"!==n.status||n.value.id!==e))))}),[]),setUploaded:l.useCallback(((e,n)=>{s((s=>s.map((s=>"pending"===s.status&&s.id===e?{status:"uploaded",value:n}:s))))}),[])}}(j.map((e=>({status:"uploaded",value:e})))??[]),{addToast:w}=i(),{t:k}=c(),q=l.useCallback((n=>{w((({close:s})=>e.jsxs(u,{type:"error",children:[e.jsx(d,{children:k("new-request-form.attachments.upload-error-title","Upload error")}),k("new-request-form.attachments.upload-error-description","There was an error uploading {{fileName}}. Try again or upload another file.",{fileName:n}),e.jsx(p,{"aria-label":k("new-request-form.close-label","Close"),onClick:s})]})))}),[w,k]),_=l.useCallback((async e=>{const n=await Pe();for(const s of e){const e=new XMLHttpRequest,t=new URL(`${window.location.origin}/api/v2/uploads.json`);if(t.searchParams.append("filename",s.name),e.open("POST",t),s.type)e.setRequestHeader("Content-Type",s.type);else{const n=F.getType(s.name);e.setRequestHeader("Content-Type",n||"application/octet-stream")}e.setRequestHeader("X-CSRF-Token",n),e.responseType="json";const a=crypto.randomUUID();b(a,s.name,e),e.upload.addEventListener("progress",(({loaded:e,total:n})=>{const s=Math.round(e/n*100);s<=90&&g(a,s)})),e.addEventListener("load",(()=>{if(e.status>=200&&e.status<300){const{upload:{attachment:{file_name:n,content_url:s},token:t}}=e.response;x(a,{id:t,file_name:n,url:s})}else q(s.name),v(a)})),e.addEventListener("error",(()=>{q(s.name),v(a)})),e.send(s)}}),[b,v,g,x,q]),{getRootProps:C,getInputProps:S,isDragActive:T}=I({onDrop:_});return e.jsxs(n,{children:[e.jsx(s,{children:a}),m&&e.jsx(o,{validation:"error",children:m}),e.jsxs(P,{...C(),isDragging:T,children:[T?e.jsx("span",{children:k("new-request-form.attachments.drop-files-label","Drop files here")}):e.jsx("span",{children:k("new-request-form.attachments.choose-file-label","Choose a file or drag and drop here")}),e.jsx(r,{...S()})]}),f.map((n=>e.jsx(Ie,{file:n,onRemove:()=>{(async e=>{if("pending"===e.status)e.xhr.abort(),v(e.id);else{const n=await Pe(),s=e.value.id;y(e.value.id),await fetch(`/api/v2/uploads/${s}.json`,{method:"DELETE",headers:{"X-CSRF-Token":n}})}})(n)}},"pending"===n.status?n.id:n.value.id))),f.map((n=>"uploaded"===n.status&&e.jsx("input",{type:"hidden",name:h,value:JSON.stringify(n.value)},n.value.id)))]})}function $e(e,n){return n.filter((n=>n.child_fields.some((n=>n.id===e))))}function Le(e,n,s){return e.filter((e=>{const t=s.find((n=>n.id===e.parent_field_id));if(!t)return!1;const a=$e(t.id,n);return t.value===e.value&&(0===a.length||Le(a,n,s).length>0)}))}function Ee(e,n){return 0===n.length?e:e.reduce(((s,t)=>{const a=$e(t.id,n);if(0===a.length)return[...s,t];const r=Le(a,n,e);return r.length>0?[...s,{...t,required:r.some((e=>e.child_fields.some((e=>e.id==t.id&&e.is_required))))}]:s}),[])}function De({field:i,locale:c,valueFormat:u,onChange:d}){const{label:p,error:m,value:h,name:j,required:f,description:b}=i,[g,x]=l.useState(h?new Date(h):void 0),v=e=>{if(void 0===e)return"";const n=e.toISOString();return"dateTime"===u?n:n.split("T")[0]};return e.jsxs(n,{children:[e.jsxs(s,{children:[p,f&&e.jsx(t,{"aria-hidden":"true",children:"*"})]}),b&&e.jsx(a,{dangerouslySetInnerHTML:{__html:b}}),e.jsx(R,{value:g,onChange:e=>{const n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0));x(n);const s=v(n);void 0!==s&&d(s)},locale:c,children:e.jsx(r,{required:f,lang:c,onChange:e=>{""===e.target.value&&(x(void 0),d(""))},validation:m?"error":void 0})}),m&&e.jsx(o,{validation:"error",children:m}),e.jsx("input",{type:"hidden",name:j,value:v(g)})]})}const Me=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,ze=m(E)`
  padding: ${e=>`${e.theme.space.xxs} ${e.theme.space.sm}`};

  // Removes white spaces for inline elements
  font-size: 0;

  // Same as height of Tag size="large" + base space (4px)
  // to give some vertical space between tags
  --line-height: ${e=>8*e.theme.space.base+e.theme.space.base}px;
  line-height: var(--line-height);
`,Ge=m.span`
  display: inline-block;
  margin-right: ${e=>e.theme.space.sm};
`,Ve=m(D)`
  ${e=>L({theme:e.theme,shadowWidth:"sm",selector:"&:focus"})}
`,Ae=m.div`
  display: inline-block;
  position: relative;
`,He=m(E)`
  display: inline-block;
  min-width: 200px;
  opacity: 0;
  user-select: none;
  height: var(--line-height);
  line-height: var(--line-height);
`,Xe=m(r)`
  position: absolute;
  top: 0;
  left: 0;
  height: var(--line-height);
  line-height: var(--line-height);
`;function Ne({field:r}){const{label:i,value:u,name:d,error:p,description:m}=r,{t:h}=c(),j=u?u.split(",").map((e=>e.trim())):[],[f,b]=l.useState(j),[g,x]=l.useState(""),v=l.useRef(null),y=l.useRef(null),{getContainerProps:w,getGridProps:k,getGridRowProps:q,getGridCellProps:_,getTagCloseProps:S,getInputProps:T,getAnnouncementProps:F,announcement:I}=function({tags:e,onTagsChange:n,inputValue:s,onInputValueChange:t,inputRef:a,gridRowRef:r,i18n:o}){const[i,c]=l.useState(0),[u,d]=l.useState(""),p=l.useCallback(((e,n)=>{c(n)}),[c]),{getGridProps:m,getGridCellProps:h}=$({matrix:[e],rowIndex:0,colIndex:i,onChange:p}),j=n=>e.includes(n),f=s=>{n([...e,s]),d(o.addedTag(s))},b=s=>{const t=e[s];n(e.filter(((e,n)=>n!==s))),d(o.removedTag(t)),c(0),setTimeout((()=>{const e=r.current?.querySelector('[tabindex="0"]');e?.focus()}),100)},g=e=>{e.target===e.currentTarget&&a.current?.focus()},x=()=>{c(0)},v=e=>{const n=e.target.value;!n||"Space"!==e.code&&"Enter"!==e.code&&"Comma"!==e.code&&"Tab"!==e.code||(e.preventDefault(),j(n)||f(n),t(""))},y=e=>{const n=e.target.value,[s,a]=[n.slice(0,-1),n.slice(-1)];" "===a||","===a?(s.length>0&&!j(s)&&f(s),t("")):t(n)},w=s=>{s.preventDefault();const t=s.clipboardData.getData("text"),a=new Set(t.split(/[\s,;]+/).filter((n=>!e.includes(n))));n([...e,...a]),d(o.addedTags([...a]))},k=e=>n=>{"Backspace"===n.code&&(n.preventDefault(),b(e))},q=e=>()=>{b(e)};return{getContainerProps:()=>({onClick:g,onBlur:x,tabIndex:-1}),getGridProps:m,getGridRowProps:()=>({role:"row"}),getGridCellProps:e=>h({rowIndex:0,colIndex:e,onKeyDown:k(e)}),getTagCloseProps:e=>({onClick:q(e)}),getInputProps:()=>({value:s,onChange:y,onKeyDown:v,onPaste:w}),announcement:u,getAnnouncementProps:()=>({"aria-live":"polite","aria-relevant":"text"})}}({tags:f,onTagsChange:b,inputValue:g,onInputValueChange:x,inputRef:v,gridRowRef:y,i18n:{addedTag:e=>h("new-request-form.cc-field.email-added","{{email}} has been added",{email:e}),removedTag:e=>h("new-request-form.cc-field.email-removed","{{email}} has been removed",{email:e}),addedTags:e=>h("new-request-form.cc-field.emails-added","{{emails}} have been added",{emails:e})}}),P=(n,s,t)=>e.jsxs(Ve,{size:"large","aria-label":h("new-request-form.cc-field.email-label","{{email}} - Press Backspace to remove",{email:t}),hue:s?void 0:"red",children:[!s&&e.jsx(D.Avatar,{children:e.jsx(M,{})}),e.jsx("span",{children:t}),e.jsx(D.Close,{...S(n)})]});return e.jsxs(n,{children:[e.jsx(s,{children:i}),m&&e.jsx(a,{children:m}),e.jsxs(ze,{...w(),children:[f.length>0&&e.jsx("span",{...k({"aria-label":h("new-request-form.cc-field.container-label","Selected CC emails")}),children:e.jsx("span",{ref:y,...q(),children:f.map(((n,s)=>{const t=Me.test(n);return t?e.jsx(Ge,{..._(s),children:P(s,t,n)},s):e.jsx(C,{content:h("new-request-form.cc-field.invalid-email","Invalid email address"),children:e.jsx(Ge,{..._(s),children:P(s,t,n)})},s)}))})}),e.jsxs(Ae,{children:[e.jsx(He,{isBare:!0,"aria-hidden":"true",tabIndex:-1,children:g}),e.jsx(Xe,{ref:v,isBare:!0,...T()})]})]}),p&&e.jsx(o,{validation:"error",children:p}),f.map((n=>e.jsx("input",{type:"hidden",name:d,value:n},n))),e.jsx(t,{hidden:!0,...F(),children:I})]})}const Oe=m(t)`
  margin-left: ${e=>e.theme.space.xxs};
  font-weight: ${e=>e.theme.fontWeights.medium};
`;function Ue({field:r,onChange:l}){const{t:i}=c(),{label:u,error:d,value:p,name:m,required:h,description:j}=r,f=function(e){return e?e.replaceAll("X",""):""}(p);return e.jsxs(n,{children:[e.jsxs(s,{children:[u,h&&e.jsx(t,{"aria-hidden":"true",children:"*"}),e.jsx(Oe,{children:i("new-request-form.credit-card-digits-hint","(Last 4 digits)")})]}),j&&e.jsx(a,{dangerouslySetInnerHTML:{__html:j}}),e.jsx(z,{start:e.jsx(G,{}),name:m,type:"text",value:f,onChange:e=>l(e.target.value),validation:d?"error":void 0,required:h,maxLength:4,placeholder:"XXXX"}),d&&e.jsx(o,{validation:"error",children:d})]})}function Be({field:n,onChange:s}){const{label:a,options:r,error:o,value:i,name:c,required:u,description:d}=n,{currentGroup:p,isGroupIdentifier:m,setCurrentGroupByIdentifier:h}=be({options:r,hasEmptyOption:!0}),y=i??"",[k,q]=l.useState(!1),_=l.useRef(null);l.useEffect((()=>{if(_.current&&u){const e=_.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[_,u]);return e.jsxs(j,{children:[e.jsxs(f,{children:[a,u&&e.jsx(t,{"aria-hidden":"true",children:"*"})]}),d&&e.jsx(b,{dangerouslySetInnerHTML:{__html:d}}),e.jsxs(g,{ref:_,inputProps:{required:u,name:c},isEditable:!1,validation:o?"error":void 0,onChange:e=>{"string"==typeof e.selectionValue&&m(e.selectionValue)?h(e.selectionValue):("string"==typeof e.selectionValue&&s(e.selectionValue),void 0!==e.isExpanded&&q(e.isExpanded))},selectionValue:y,inputValue:y,renderValue:({selection:n})=>n?.label??e.jsx(ue,{}),isExpanded:k,children:["SubGroup"===p.type&&e.jsx(x,{...p.backOption}),"SubGroup"===p.type?e.jsx(w,{"aria-label":p.name,children:p.options.map((n=>e.jsx(x,{...n,children:n.menuLabel??n.label},n.value)))}):p.options.map((n=>""===n.value?e.jsx(x,{...n,children:e.jsx(ue,{})},n.value):e.jsx(x,{...n},n.value)))]}),o&&e.jsx(v,{validation:"error",children:o})]})}const We=V`
  from {
    grid-template-rows: 0fr;
  }
  to {
    grid-template-rows: 1fr;
  }
`,Ke=m.div`
  display: grid;
  animation: ${We} 200ms forwards;
`,Ye=m.div`
  overflow: hidden;
`,Je=m.ul`
  list-style: none;
  padding: 0;
  margin: 0;
`,Ze=m.li`
  margin: ${e=>e.theme.space.sm} 0;
`;function Qe({query:n,locale:s}){const t=function(e,n){const[s,t]=l.useState(e);return l.useEffect((()=>{const s=setTimeout((()=>t(e)),n);return()=>{clearTimeout(s)}}),[e,n]),s}(n,500),[a,r]=l.useState([]),o=l.useRef({}),{t:i}=c();return l.useEffect((()=>{const e=t?.trim().toLocaleLowerCase();if(!e||!function(e){const n=e.charCodeAt(0);return n>=19968&&n<=195103?e.length>=2:e.length>=3}(e))return void r([]);const n=new URL(`${window.location.origin}/api/v2/help_center/deflection/suggestions.json`);n.searchParams.append("locale",s),n.searchParams.append("query",e);const a=o.current[n.toString()];a?r(a):fetch(n).then((e=>e.json())).then((({results:e})=>{o.current[n.toString()]=e,r(e)}))}),[t,s]),a.length>0?e.jsx(Ke,{"data-test-id":"suggested-articles",children:e.jsxs(Ye,{children:[e.jsx("h2",{children:i("new-request-form.suggested-articles","Suggested articles")}),e.jsx(Je,{children:a.map((n=>e.jsx(Ze,{children:e.jsx(T,{href:n.html_url,children:n.name})},n.html_url)))})]})}):null}const en=m.h3`
  font-size: ${e=>e.theme.fontSizes.md};
  font-weight: ${e=>e.theme.fontWeights.bold};
`,nn=m(H)`
  color: ${e=>A("successHue",700,e.theme)};
`,sn=m(X)`
  position: absolute;
  top: ${e=>5.5*e.theme.space.base}px;
  inset-inline-start: ${e=>4*e.theme.space.base+"px"};
`,tn=m(T)`
  display: inline-block;
  margin-top: ${e=>e.theme.space.sm};
`;function an({authToken:n,interactionAccessToken:s,articles:t,requestId:a,hasRequestManagement:r,isSignedIn:o,helpCenterPath:i,requestsPath:u,requestPath:d}){const[p,m]=l.useState(0),h=N(),{t:j}=c(),f=()=>String(t[p]?.article_id),b=()=>{Q({type:"success",message:j("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")}),window.location.assign((()=>{if(o)return r?d:i;{const e=new URLSearchParams;return e.set("return_to",u),`${i}?${e.toString()}`}})())};return e.jsxs(O,{appendToNode:h,onClose:()=>{b()},children:[e.jsxs(nn,{tag:"h2",children:[e.jsx(sn,{}),j("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")]}),e.jsxs(U,{children:[e.jsx(en,{children:j("new-request-form.answer-bot-modal.title","While you wait, do any of these articles answer your question?")}),e.jsx("p",{children:j("new-request-form.answer-bot-modal.footer-content","If it does, we can close your recent request {{requestId}}",{requestId:`‭#${a}‬`})}),e.jsx(B,{level:4,expandedSections:[p],onChange:e=>{m(e)},children:t.map((({article_id:s,html_url:t,snippet:a,title:r})=>e.jsxs(B.Section,{children:[e.jsx(B.Header,{children:e.jsx(B.Label,{children:r})}),e.jsxs(B.Panel,{children:[e.jsx(W,{dangerouslySetInnerHTML:{__html:a}}),e.jsx(tn,{isExternal:!0,href:`${t}?auth_token=${n}`,target:"_blank",children:j("new-request-form.answer-bot-modal.view-article","View article")})]})]},s)))})]}),e.jsxs(K,{children:[e.jsx(Y,{children:e.jsx(J,{onClick:()=>{(async()=>{await fetch("/api/v2/answer_bot/rejection",{method:"POST",body:JSON.stringify({article_id:f(),interaction_access_token:s,reason_id:0}),headers:{"Content-Type":"application/json"}}),b()})()},children:j("new-request-form.answer-bot-modal.mark-irrelevant","No, I need help")})}),e.jsx(Y,{children:e.jsx(J,{isPrimary:!0,onClick:()=>{(async()=>{(await fetch("/api/v2/answer_bot/resolution",{method:"POST",body:JSON.stringify({article_id:f(),interaction_access_token:s}),headers:{"Content-Type":"application/json"}})).ok?Q({type:"success",message:j("new-request-form.answer-bot-modal.request-closed","Nice. Your request has been closed.")}):Q({type:"error",message:j("new-request-form.answer-bot-modal.solve-error","There was an error closing your request")}),window.location.href=i})()},children:j("new-request-form.answer-bot-modal.solve-request","Yes, close my request")})})]}),e.jsx(Z,{"aria-label":j("new-request-form.close-label","Close")})]})}const rn=m(W)`
  margin: ${e=>e.theme.space.md} 0;
`,on=m.form`
  display: flex;
  flex-direction: column;
  gap: ${e=>e.theme.space.md};
`,ln=m.div`
  margin-top: ${e=>e.theme.space.md};
`;function cn({requestForm:n,wysiwyg:s,newRequestPath:t,parentId:a,parentIdPath:r,locale:o,baseLocale:i,hasAtMentions:u,userRole:d,brandId:p,answerBotModal:m}){const{ticket_fields:h,action:j,http_method:f,accept_charset:b,errors:g,parent_id_field:x,ticket_form_field:v,email_field:y,cc_field:w,organization_field:k,due_date_field:q,end_user_conditions:_,attachments_field:C,inline_attachments_fields:S,description_mimetype_field:F}=n,{answerBot:I}=m,{ticketFields:P,emailField:R,ccField:$,organizationField:L,dueDateField:E}=Te({ticketFields:h,emailField:y,ccField:w,organizationField:k,dueDateField:q}),[D,M]=l.useState(P),[z,G]=l.useState(L),[V,A]=l.useState(E),H=Ee(D,_),{formRefCallback:X,handleSubmit:N}=we(D),{t:O}=c();function U(e,n){M(D.map((s=>s.name===e.name?{...s,value:n}:s)))}return e.jsxs(e.Fragment,{children:[a&&e.jsx(rn,{children:e.jsx(T,{href:r,children:O("new-request-form.parent-request-link","Follow-up to request {{parentId}}",{parentId:`‭#${a}‬`})})}),e.jsx(rn,{"aria-hidden":"true",children:O("new-request-form.required-fields-info","Fields marked with an asterisk (*) are required.")}),e.jsxs(on,{ref:X,action:j,method:f,acceptCharset:b,noValidate:!0,onSubmit:N,children:[g&&e.jsx(ee,{type:"error",children:g}),x&&e.jsx(ye,{field:x}),v.options.length>0&&e.jsx(ve,{field:v,newRequestPath:t}),R&&e.jsx(oe,{field:R},R.name),$&&e.jsx(Ne,{field:$}),z&&e.jsx(de,{field:z,onChange:e=>{!function(e){null!==z&&G({...z,value:e})}(e)}},z.name),H.map((n=>{switch(n.type){case"subject":return e.jsxs(e.Fragment,{children:[e.jsx(oe,{field:n,onChange:e=>U(n,e)},n.name),e.jsx(Qe,{query:n.value,locale:o})]});case"text":case"integer":case"decimal":case"regexp":return e.jsx(oe,{field:n,onChange:e=>U(n,e)},n.name);case"partialcreditcard":return e.jsx(Ue,{field:n,onChange:e=>U(n,e)});case"description":return e.jsxs(e.Fragment,{children:[e.jsx(ce,{field:n,hasWysiwyg:s,baseLocale:i,hasAtMentions:u,userRole:d,brandId:p,onChange:e=>U(n,e)},n.name),e.jsx("input",{type:"hidden",name:F.name,value:s?"text/html":"text/plain"})]});case"textarea":return e.jsx(ce,{field:n,hasWysiwyg:!1,baseLocale:i,hasAtMentions:u,userRole:d,brandId:p,onChange:e=>U(n,e)},n.name);case"priority":case"basic_priority":case"tickettype":return e.jsxs(e.Fragment,{children:[e.jsx(de,{field:n,onChange:e=>U(n,e)},n.name),"task"===n.value&&e.jsx(De,{field:V,locale:i,valueFormat:"dateTime",onChange:e=>{!function(e){null!==V&&A({...V,value:e})}(e)}})]});case"checkbox":return e.jsx(pe,{field:n,onChange:e=>U(n,e)});case"date":return e.jsx(De,{field:n,locale:i,valueFormat:"date",onChange:e=>U(n,e)});case"multiselect":return e.jsx(ge,{field:n});case"tagger":return e.jsx(Be,{field:n,onChange:e=>U(n,e)},n.name);default:return e.jsx(e.Fragment,{})}})),C&&e.jsx(Re,{field:C}),S.map((({type:n,name:s,value:t},a)=>e.jsx("input",{type:n,name:s,value:t},a))),e.jsx(ln,{children:(0===v.options.length||v.value)&&e.jsx(J,{isPrimary:!0,type:"submit",children:O("new-request-form.submit","Submit")})})]}),I.auth_token&&I.interaction_access_token&&I.articles.length>0&&I.request_id&&e.jsx(an,{authToken:I.auth_token,interactionAccessToken:I.interaction_access_token,articles:I.articles,requestId:I.request_id,...m})]})}async function un(n,s,t){const{baseLocale:a}=s;ne(a),await se(a,(()=>function(e){switch(e){case"./translations/locales/af.json":return import("af");case"./translations/locales/ar-x-pseudo.json":return import("ar-x-pseudo");case"./translations/locales/ar.json":return import("ar");case"./translations/locales/az.json":return import("az");case"./translations/locales/be.json":return import("be");case"./translations/locales/bg.json":return import("bg");case"./translations/locales/bn.json":return import("bn");case"./translations/locales/bs.json":return import("bs");case"./translations/locales/ca.json":return import("ca");case"./translations/locales/cs.json":return import("cs");case"./translations/locales/cy.json":return import("cy");case"./translations/locales/da.json":return import("da");case"./translations/locales/de-x-informal.json":return import("de-x-informal");case"./translations/locales/de.json":return import("de");case"./translations/locales/el.json":return import("el");case"./translations/locales/en-001.json":return import("en-001");case"./translations/locales/en-150.json":return import("en-150");case"./translations/locales/en-au.json":return import("en-au");case"./translations/locales/en-ca.json":return import("new-request-form-translations").then((function(e){return e.e}));case"./translations/locales/en-gb.json":return import("new-request-form-translations").then((function(e){return e.a}));case"./translations/locales/en-my.json":return import("en-my");case"./translations/locales/en-ph.json":return import("en-ph");case"./translations/locales/en-se.json":return import("en-se");case"./translations/locales/en-us.json":return import("new-request-form-translations").then((function(e){return e.b}));case"./translations/locales/en-x-dev.json":return import("en-x-dev");case"./translations/locales/en-x-keys.json":return import("en-x-keys");case"./translations/locales/en-x-obsolete.json":return import("en-x-obsolete");case"./translations/locales/en-x-pseudo.json":return import("en-x-pseudo");case"./translations/locales/en-x-test.json":return import("en-x-test");case"./translations/locales/es-419.json":return import("es-419");case"./translations/locales/es-es.json":return import("es-es");case"./translations/locales/es.json":return import("es");case"./translations/locales/et.json":return import("et");case"./translations/locales/eu.json":return import("eu");case"./translations/locales/fa-af.json":return import("fa-af");case"./translations/locales/fa.json":return import("fa");case"./translations/locales/fi.json":return import("fi");case"./translations/locales/fil.json":return import("fil");case"./translations/locales/fo.json":return import("fo");case"./translations/locales/fr-ca.json":return import("fr-ca");case"./translations/locales/fr.json":return import("fr");case"./translations/locales/ga.json":return import("ga");case"./translations/locales/he.json":return import("he");case"./translations/locales/hi.json":return import("hi");case"./translations/locales/hr.json":return import("hr");case"./translations/locales/hu.json":return import("hu");case"./translations/locales/hy.json":return import("hy");case"./translations/locales/id.json":return import("id");case"./translations/locales/is.json":return import("is");case"./translations/locales/it-ch.json":return import("it-ch");case"./translations/locales/it.json":return import("it");case"./translations/locales/ja.json":return import("ja");case"./translations/locales/ka.json":return import("ka");case"./translations/locales/kk.json":return import("kk");case"./translations/locales/kl-dk.json":return import("kl-dk");case"./translations/locales/ko.json":return import("ko");case"./translations/locales/ku.json":return import("ku");case"./translations/locales/lt.json":return import("lt");case"./translations/locales/lv.json":return import("lv");case"./translations/locales/mk.json":return import("mk");case"./translations/locales/mn.json":return import("mn");case"./translations/locales/ms.json":return import("ms");case"./translations/locales/mt.json":return import("mt");case"./translations/locales/my.json":return import("my");case"./translations/locales/nl-be.json":return import("nl-be");case"./translations/locales/nl.json":return import("nl");case"./translations/locales/no.json":return import("no");case"./translations/locales/pl.json":return import("pl");case"./translations/locales/pt-br.json":return import("pt-br");case"./translations/locales/pt.json":return import("pt");case"./translations/locales/ro.json":return import("ro");case"./translations/locales/ru.json":return import("ru");case"./translations/locales/sk.json":return import("sk");case"./translations/locales/sl.json":return import("sl");case"./translations/locales/sq.json":return import("sq");case"./translations/locales/sr-me.json":return import("sr-me");case"./translations/locales/sr.json":return import("sr");case"./translations/locales/sv.json":return import("sv");case"./translations/locales/th.json":return import("th");case"./translations/locales/tr.json":return import("tr");case"./translations/locales/uk.json":return import("uk");case"./translations/locales/ur.json":return import("ur");case"./translations/locales/uz.json":return import("uz");case"./translations/locales/vi.json":return import("vi");case"./translations/locales/zh-cn.json":return import("zh-cn");case"./translations/locales/zh-tw.json":return import("zh-tw");default:return new Promise((function(n,s){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`./translations/locales/${a}.json`))),te.render(e.jsx(ae,{theme:re(n),children:e.jsx(cn,{...s})}),t)}export{un as renderNewRequestForm};
