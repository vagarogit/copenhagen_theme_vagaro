import{j as e,r as n,u as t,s as r,p as s,m as a,a as o,b as i,S as l,c as u,$ as c,d,e as m,f,i as h,l as p,g as j,T as g,h as b}from"shared";import{Field as x,Label as w,Hint as q,Input as v,Message as y,Textarea as k,Checkbox as _,FileList as C,File as S,FileUpload as F,FauxInput as T,MediaInput as I}from"@zendeskgarden/react-forms";import{Span as P,Paragraph as R}from"@zendeskgarden/react-typography";import{useToast as $,Notification as L,Title as E,Close as z,Alert as D}from"@zendeskgarden/react-notifications";import{Field as M,Label as G,Hint as V,Combobox as A,Option as H,Message as X,OptGroup as N}from"@zendeskgarden/react-dropdowns.next";import{Anchor as O,Button as U}from"@zendeskgarden/react-buttons";import{Progress as B}from"@zendeskgarden/react-loaders";import{Tooltip as W}from"@zendeskgarden/react-tooltips";import{Datepicker as K}from"@zendeskgarden/react-datepickers";import{Tag as Y}from"@zendeskgarden/react-tags";import{focusStyles as J,getColorV8 as Z}from"@zendeskgarden/react-theming";import{Header as Q,Modal as ee,Body as ne,Footer as te,FooterItem as re,Close as se}from"@zendeskgarden/react-modals";import{Accordion as ae}from"@zendeskgarden/react-accordions";function oe({field:n,onChange:t}){const{label:r,error:s,value:a,name:o,required:i,description:l,type:u}=n,c={},d="integer"===u||"decimal"===u?"number":"text";"integer"===u&&(c.step="1"),"decimal"===u&&(c.step="any");const m="anonymous_requester_email"===u?"email":void 0;return e.jsxs(x,{children:[e.jsxs(w,{children:[r,i&&e.jsx(P,{"aria-hidden":"true",children:"*"})]}),l&&e.jsx(q,{dangerouslySetInnerHTML:{__html:l}}),e.jsx(v,{name:o,type:d,defaultValue:a,validation:s?"error":void 0,required:i,onChange:e=>{t&&t(e.target.value)},autoComplete:m,...c}),s&&e.jsx(y,{validation:"error",children:s})]})}const ie=r(x)`
  .ck.ck-editor {
    margin-top: ${e=>e.theme.space.xs};
  }
`,le=r(y)`
  .ck.ck-editor + & {
    margin-top: ${e=>e.theme.space.xs};
  }
`;function ue({field:r,hasWysiwyg:s,baseLocale:a,hasAtMentions:o,userRole:i,brandId:l,onChange:u}){const{label:c,error:d,value:m,name:f,required:h,description:p}=r,j=function({hasWysiwyg:r,baseLocale:s,hasAtMentions:a,userRole:o,brandId:i}){const l=n.useRef(!1),{addToast:u}=$(),{t:c}=t();return n.useCallback((async n=>{if(r&&n&&!l.current){l.current=!0;const{createEditor:t}=await import("@zendesk/help-center-wysiwyg");(await t(n,{editorType:"supportRequests",hasAtMentions:a,userRole:o,brandId:i,baseLocale:s})).plugins.get("Notification").on("show",((n,t)=>{n.stop();const r=t.message instanceof Error?t.message.message:t.message,{type:s,title:a}=t;u((({close:n})=>e.jsxs(L,{type:s,children:[e.jsx(E,{children:a}),r,e.jsx(z,{"aria-label":c("new-request-form.close-label","Close"),onClick:n})]})))}))}}),[r,s,a,o,i,u,c])}({hasWysiwyg:s,baseLocale:a,hasAtMentions:o,userRole:i,brandId:l});return e.jsxs(ie,{children:[e.jsxs(w,{children:[c,h&&e.jsx(P,{"aria-hidden":"true",children:"*"})]}),p&&e.jsx(q,{dangerouslySetInnerHTML:{__html:p}}),e.jsx(k,{ref:j,name:f,defaultValue:m,validation:d?"error":void 0,required:h,onChange:e=>u(e.target.value),rows:6,isResizable:!0}),d&&e.jsx(le,{validation:"error",children:d})]})}function ce(){const{t:n}=t();return e.jsxs(e.Fragment,{children:[e.jsx(P,{"aria-hidden":"true",children:"-"}),e.jsx(P,{hidden:!0,children:n("new-request-form.dropdown.empty-option","Select an option")})]})}function de({field:t,onChange:r}){const{label:s,options:a,error:o,value:i,name:l,required:u,description:c}=t,d=null==i?"":i.toString(),m=n.useRef(null);return n.useEffect((()=>{if(m.current&&u){const e=m.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[m,u]),e.jsxs(M,{children:[e.jsxs(G,{children:[s,u&&e.jsx(P,{"aria-hidden":"true",children:"*"})]}),c&&e.jsx(V,{dangerouslySetInnerHTML:{__html:c}}),e.jsxs(A,{ref:m,inputProps:{name:l,required:u},isEditable:!1,validation:o?"error":void 0,inputValue:d,selectionValue:d,renderValue:({selection:n})=>n?.label||e.jsx(ce,{}),onChange:({selectionValue:e})=>{void 0!==e&&r(e)},children:[!u&&e.jsx(H,{value:"",label:"-",children:e.jsx(ce,{})}),a.map((n=>e.jsx(H,{value:n.value.toString(),label:n.name},n.value)))]}),o&&e.jsx(X,{validation:"error",children:o})]})}function me({field:t,onChange:r}){const{label:s,error:a,value:o,name:i,required:l,description:u}=t,[c,d]=n.useState(o);return e.jsxs(x,{children:[e.jsx("input",{type:"hidden",name:i,value:"off"}),e.jsxs(_,{name:i,required:l,defaultChecked:o,value:c?"on":"off",onChange:e=>{const{checked:n}=e.target;d(n),r(n)},children:[e.jsxs(w,{children:[s,l&&e.jsx(P,{"aria-hidden":"true",children:"*"})]}),u&&e.jsx(q,{dangerouslySetInnerHTML:{__html:u}})]}),a&&e.jsx(y,{validation:"error",children:a})]})}const fe="[]";function he(e){return`[${e.join("::")}]`}function pe(e){return e.startsWith("[")&&e.endsWith("]")}function je(e){const n=he(e.slice(0,-1));return{type:"SubGroup",name:e[e.length-1],backOption:{type:"previous",label:"Back",value:n},options:[]}}function ge({options:e,hasEmptyOption:t}){const r=n.useMemo((()=>function(e,n){const t={[fe]:{type:"RootGroup",options:n?[{label:"-",value:""}]:[]}};return e.forEach((e=>{const{name:n,value:r}=e;if(n.includes("::")){const[e,s]=function(e){const n=e.split("::");return[n.slice(0,-1),n.slice(-1)[0]]}(n),a=he(e);t[a]||(t[a]=je(e)),t[a]?.options.push({value:r,label:n.split("::").join(" > "),menuLabel:s});for(let n=0;n<e.length;n++){const r=e.slice(0,n),s=e.slice(0,n+1),a=he(r),o=he(s);t[a]||(t[a]=je(r)),void 0===t[a]?.options.find((e=>e.value===o))&&t[a]?.options.push({type:"next",label:s[s.length-1],value:o})}}else t[fe].options.push({value:r,label:n})})),t}(e,t)),[e,t]),[s,a]=n.useState(function(e){const n={type:"RootGroup",options:[]};return Object.values(e).forEach((({options:e})=>{n.options.push(...e.filter((({type:e})=>void 0===e)))})),n}(r));n.useEffect((()=>{a(r[fe])}),[r]);return{currentGroup:s,isGroupIdentifier:pe,setCurrentGroupByIdentifier:e=>{const n=r[e];n&&a(n)}}}function be({field:t}){const{label:r,options:s,error:a,value:o,name:i,required:l,description:u}=t,{currentGroup:c,isGroupIdentifier:d,setCurrentGroupByIdentifier:m}=ge({options:s,hasEmptyOption:!1}),[f,h]=n.useState(o||[]),p=n.useRef(null);n.useEffect((()=>{if(p.current&&l){const e=p.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[p,l]);return e.jsxs(M,{children:[f.map((n=>e.jsx("input",{type:"hidden",name:`${i}[]`,value:n},n))),e.jsxs(G,{children:[r,l&&e.jsx(P,{"aria-hidden":"true",children:"*"})]}),u&&e.jsx(V,{dangerouslySetInnerHTML:{__html:u}}),e.jsxs(A,{ref:p,isMultiselectable:!0,inputProps:{required:l},isEditable:!1,validation:a?"error":void 0,onChange:e=>{if(Array.isArray(e.selectionValue)){const n=e.selectionValue.slice(-1).toString();d(n)?m(n):h(e.selectionValue)}},selectionValue:f,maxHeight:"auto",children:["SubGroup"===c.type&&e.jsx(H,{...c.backOption}),"SubGroup"===c.type?e.jsx(N,{"aria-label":c.name,children:c.options.map((n=>e.jsx(H,{...n,children:n.menuLabel??n.label},n.value)))}):c.options.map((n=>e.jsx(H,{...n},n.value)))]}),a&&e.jsx(X,{validation:"error",children:a})]})}const xe="return-focus-to-ticket-form-field";function we({field:t,newRequestPath:r}){const s=n.createRef();return n.useEffect((()=>{sessionStorage.getItem(xe)&&(sessionStorage.removeItem(xe),s.current?.firstChild?.focus())}),[]),e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"hidden",name:t.name,value:t.value}),t.options.length>1&&e.jsxs(M,{children:[e.jsx(G,{children:t.label}),e.jsx(A,{isEditable:!1,onChange:({selectionValue:e})=>{if(e&&"number"==typeof e){const n=new URL(window.location.href);n.searchParams.set("ticket_form_id",e),sessionStorage.setItem(xe,"true"),window.location.assign(`${r}${n.search}`)}},ref:s,children:t.options.map((n=>e.jsx(H,{value:n.value,label:n.name,isSelected:t.value===n.value,children:n.name},n.value)))})]})]})}function qe({field:n}){const{value:t,name:r}=n;return e.jsx("input",{type:"hidden",name:r,value:t})}function ve(e){const t=n.useRef(!1),r=n.useRef(!1);return{formRefCallback:n.useCallback((n=>{n&&!t.current&&(t.current=!0,n.submit=async()=>{if(!1===r.current){r.current=!0;const t=await async function(){const e=await fetch("/api/v2/help_center/sessions.json"),{current_session:n}=await e.json();return n.csrf_token}(),s=document.createElement("input");s.type="hidden",s.name="authenticity_token",s.value=t,n.appendChild(s);const a=e.filter((e=>"partialcreditcard"===e.type));for(const e of a){const t=n.querySelector(`input[name="${e.name}"]`);t&&t instanceof HTMLInputElement&&4===t.value.length&&(t.value=`XXXXXXXXX${t.value}`)}HTMLFormElement.prototype.submit.call(n)}})}),[e]),handleSubmit:e=>{e.preventDefault(),e.target.submit()}}}const ye=2048,ke="tf_",_e=["true","false"],Ce=["pre","strong","b","p","blockquote","ul","ol","li","h2","h3","h4","i","em","br"];function Se(e,n){if(!Number.isNaN(Number(e))){const t=`request[custom_fields][${e}]`;return n.ticketFields.find((e=>e.name===t))}switch(e){case"anonymous_requester_email":return n.emailField;case"due_at":return n.dueDateField;case"collaborators":return n.ccField;case"organization_id":return n.organizationField;default:return n.ticketFields.find((n=>n.name===`request[${e}]`))}}function Fe({ticketFields:e,ccField:t,dueDateField:r,emailField:a,organizationField:o}){return n.useMemo((()=>function(e){const{href:n}=location,t=new URL(n).searchParams,r={...e,ticketFields:[...e.ticketFields]};if(n.length>ye)return e;if(t.get("parent_id"))return e;for(const[e,n]of t){if(!e.startsWith(ke))continue;const t=Se(e.substring(ke.length),r);if(!t)continue;const a=s.sanitize(n,{ALLOWED_TAGS:Ce});switch(t.type){case"partialcreditcard":continue;case"multiselect":t.value=a.split(",").filter((e=>t.options.some((n=>n.value===e))));break;case"checkbox":_e.includes(a)&&(t.value="true"===a?"on":"false"===a?"off":"");break;default:t.value=a}}return r}({ticketFields:e,ccField:t,dueDateField:r,emailField:a,organizationField:o})),[e,t,r,a,o])}const Te=r.div`
  flex: 1;
`;function Ie({file:n,onRemove:r}){const{t:s}=t(),a=e=>{"Enter"!==e.code&&"Space"!==e.code&&"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),r())},o="pending"===n.status?n.file_name:n.value.file_name,i=s("new-request-form.attachments.stop-upload","Stop upload"),l=s("new-request-form.attachments.remove-file","Remove file");return e.jsx(C.Item,{children:e.jsx(S,{type:"generic",title:o,onKeyDown:e=>{"Delete"!==e.code&&"Backspace"!==e.code||(e.preventDefault(),r())},children:"pending"===n.status?e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:o}),e.jsx(W,{content:i,children:e.jsx(S.Close,{"aria-label":i,onClick:()=>{r()},onKeyDown:a})}),e.jsx(B,{value:n.progress,"aria-label":s("new-request-form.attachments.uploading","Uploading {{fileName}}",{fileName:o})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{children:e.jsx(O,{isExternal:!0,href:n.value.url,target:"_blank",children:o})}),e.jsx(W,{content:l,children:e.jsx(S.Delete,{"aria-label":l,onClick:()=>{r()},onKeyDown:a})}),e.jsx(B,{value:100,"aria-hidden":"true"})]})})})}async function Pe(){const e=await fetch("/api/v2/users/me.json"),{user:{authenticity_token:n}}=await e.json();return n}function Re({field:r}){const{label:s,error:i,name:l,attachments:u}=r,{files:c,addPendingFile:d,setPendingFileProgress:m,setUploaded:f,removePendingFile:h,removeUploadedFile:p}=function(e){const[t,r]=n.useState(e);return{files:t,addPendingFile:n.useCallback(((e,n,t)=>{r((r=>[...r,{status:"pending",id:e,file_name:n,progress:0,xhr:t}]))}),[]),setPendingFileProgress:n.useCallback(((e,n)=>{r((t=>t.map((t=>"pending"===t.status&&t.id===e?{...t,progress:n}:t))))}),[]),removePendingFile:n.useCallback((e=>{r((n=>n.filter((n=>"pending"!==n.status||n.id!==e))))}),[]),removeUploadedFile:n.useCallback((e=>{r((n=>n.filter((n=>"uploaded"!==n.status||n.value.id!==e))))}),[]),setUploaded:n.useCallback(((e,n)=>{r((t=>t.map((t=>"pending"===t.status&&t.id===e?{status:"uploaded",value:n}:t))))}),[])}}(u.map((e=>({status:"uploaded",value:e})))??[]),{addToast:j}=$(),{t:g}=t(),b=n.useCallback((n=>{j((({close:t})=>e.jsxs(L,{type:"error",children:[e.jsx(E,{children:g("new-request-form.attachments.upload-error-title","Upload error")}),g("new-request-form.attachments.upload-error-description","There was an error uploading {{fileName}}. Try again or upload another file.",{fileName:n}),e.jsx(z,{"aria-label":g("new-request-form.close-label","Close"),onClick:t})]})))}),[j,g]),q=n.useCallback((async e=>{const n=await Pe();for(const t of e){const e=new XMLHttpRequest,r=new URL(`${window.location.origin}/api/v2/uploads.json`);if(r.searchParams.append("filename",t.name),e.open("POST",r),t.type)e.setRequestHeader("Content-Type",t.type);else{const n=a.getType(t.name);e.setRequestHeader("Content-Type",n||"application/octet-stream")}e.setRequestHeader("X-CSRF-Token",n),e.responseType="json";const s=crypto.randomUUID();d(s,t.name,e),e.upload.addEventListener("progress",(({loaded:e,total:n})=>{const t=Math.round(e/n*100);t<=90&&m(s,t)})),e.addEventListener("load",(()=>{if(e.status>=200&&e.status<300){const{upload:{attachment:{file_name:n,content_url:t},token:r}}=e.response;f(s,{id:r,file_name:n,url:t})}else b(t.name),h(s)})),e.addEventListener("error",(()=>{b(t.name),h(s)})),e.send(t)}}),[d,h,m,f,b]),{getRootProps:k,getInputProps:_,isDragActive:C}=o({onDrop:q});return e.jsxs(x,{children:[e.jsx(w,{children:s}),i&&e.jsx(y,{validation:"error",children:i}),e.jsxs(F,{...k(),isDragging:C,children:[C?e.jsx("span",{children:g("new-request-form.attachments.drop-files-label","Drop files here")}):e.jsx("span",{children:g("new-request-form.attachments.choose-file-label","Choose a file or drag and drop here")}),e.jsx(v,{..._()})]}),c.map((n=>e.jsx(Ie,{file:n,onRemove:()=>{(async e=>{if("pending"===e.status)e.xhr.abort(),h(e.id);else{const n=await Pe(),t=e.value.id;p(e.value.id),await fetch(`/api/v2/uploads/${t}.json`,{method:"DELETE",headers:{"X-CSRF-Token":n}})}})(n)}},"pending"===n.status?n.id:n.value.id))),c.map((n=>"uploaded"===n.status&&e.jsx("input",{type:"hidden",name:l,value:JSON.stringify(n.value)},n.value.id)))]})}function $e(e,n){return n.filter((n=>n.child_fields.some((n=>n.id===e))))}function Le(e,n,t){return e.filter((e=>{const r=t.find((n=>n.id===e.parent_field_id));if(!r)return!1;const s=$e(r.id,n);return r.value===e.value&&(0===s.length||Le(s,n,t).length>0)}))}function Ee(e,n){return 0===n.length?e:e.reduce(((t,r)=>{const s=$e(r.id,n);if(0===s.length)return[...t,r];const a=Le(s,n,e);return a.length>0?[...t,{...r,required:a.some((e=>e.child_fields.some((e=>e.id==r.id&&e.is_required))))}]:t}),[])}function ze({field:t,locale:r,valueFormat:s,onChange:a}){const{label:o,error:i,value:l,name:u,required:c,description:d}=t,[m,f]=n.useState(l?new Date(l):void 0),h=e=>{if(void 0===e)return"";const n=e.toISOString();return"dateTime"===s?n:n.split("T")[0]};return e.jsxs(x,{children:[e.jsxs(w,{children:[o,c&&e.jsx(P,{"aria-hidden":"true",children:"*"})]}),d&&e.jsx(q,{dangerouslySetInnerHTML:{__html:d}}),e.jsx(K,{value:m,onChange:e=>{const n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0));f(n);const t=h(n);void 0!==t&&a(t)},locale:r,children:e.jsx(v,{required:c,lang:r,onChange:e=>{""===e.target.value&&(f(void 0),a(""))},validation:i?"error":void 0})}),i&&e.jsx(y,{validation:"error",children:i}),e.jsx("input",{type:"hidden",name:u,value:h(m)})]})}const De=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Me=r(T)`
  padding: ${e=>`${e.theme.space.xxs} ${e.theme.space.sm}`};

  // Removes white spaces for inline elements
  font-size: 0;

  // Same as height of Tag size="large" + base space (4px)
  // to give some vertical space between tags
  --line-height: ${e=>8*e.theme.space.base+e.theme.space.base}px;
  line-height: var(--line-height);
`,Ge=r.span`
  display: inline-block;
  margin-right: ${e=>e.theme.space.sm};
`,Ve=r(Y)`
  ${e=>J({theme:e.theme,shadowWidth:"sm",selector:"&:focus"})}
`,Ae=r.div`
  display: inline-block;
  position: relative;
`,He=r(T)`
  display: inline-block;
  min-width: 200px;
  opacity: 0;
  user-select: none;
  height: var(--line-height);
  line-height: var(--line-height);
`,Xe=r(v)`
  position: absolute;
  top: 0;
  left: 0;
  height: var(--line-height);
  line-height: var(--line-height);
`;function Ne({field:r}){const{label:s,value:a,name:o,error:u,description:c}=r,{t:d}=t(),m=a?a.split(",").map((e=>e.trim())):[],[f,h]=n.useState(m),[p,j]=n.useState(""),g=n.useRef(null),b=n.useRef(null),{getContainerProps:v,getGridProps:k,getGridRowProps:_,getGridCellProps:C,getTagCloseProps:S,getInputProps:F,getAnnouncementProps:T,announcement:I}=function({tags:e,onTagsChange:t,inputValue:r,onInputValueChange:s,inputRef:a,gridRowRef:o,i18n:l}){const[u,c]=n.useState(0),[d,m]=n.useState(""),f=n.useCallback(((e,n)=>{c(n)}),[c]),{getGridProps:h,getGridCellProps:p}=i({matrix:[e],rowIndex:0,colIndex:u,onChange:f}),j=n=>e.includes(n),g=n=>{t([...e,n]),m(l.addedTag(n))},b=n=>{const r=e[n];t(e.filter(((e,t)=>t!==n))),m(l.removedTag(r)),c(0),setTimeout((()=>{const e=o.current?.querySelector('[tabindex="0"]');e?.focus()}),100)},x=e=>{e.target===e.currentTarget&&a.current?.focus()},w=()=>{c(0)},q=e=>{const n=e.target.value;!n||"Space"!==e.code&&"Enter"!==e.code&&"Comma"!==e.code&&"Tab"!==e.code||(e.preventDefault(),j(n)||g(n),s(""))},v=e=>{const n=e.target.value,[t,r]=[n.slice(0,-1),n.slice(-1)];" "===r||","===r?(t.length>0&&!j(t)&&g(t),s("")):s(n)},y=n=>{n.preventDefault();const r=n.clipboardData.getData("text"),s=new Set(r.split(/[\s,;]+/).filter((n=>!e.includes(n))));t([...e,...s]),m(l.addedTags([...s]))},k=e=>n=>{"Backspace"===n.code&&(n.preventDefault(),b(e))},_=e=>()=>{b(e)};return{getContainerProps:()=>({onClick:x,onBlur:w,tabIndex:-1}),getGridProps:h,getGridRowProps:()=>({role:"row"}),getGridCellProps:e=>p({rowIndex:0,colIndex:e,onKeyDown:k(e)}),getTagCloseProps:e=>({onClick:_(e)}),getInputProps:()=>({value:r,onChange:v,onKeyDown:q,onPaste:y}),announcement:d,getAnnouncementProps:()=>({"aria-live":"polite","aria-relevant":"text"})}}({tags:f,onTagsChange:h,inputValue:p,onInputValueChange:j,inputRef:g,gridRowRef:b,i18n:{addedTag:e=>d("new-request-form.cc-field.email-added","{{email}} has been added",{email:e}),removedTag:e=>d("new-request-form.cc-field.email-removed","{{email}} has been removed",{email:e}),addedTags:e=>d("new-request-form.cc-field.emails-added","{{emails}} have been added",{emails:e})}}),R=(n,t,r)=>e.jsxs(Ve,{size:"large","aria-label":d("new-request-form.cc-field.email-label","{{email}} - Press Backspace to remove",{email:r}),hue:t?void 0:"red",children:[!t&&e.jsx(Y.Avatar,{children:e.jsx(l,{})}),e.jsx("span",{children:r}),e.jsx(Y.Close,{...S(n)})]});return e.jsxs(x,{children:[e.jsx(w,{children:s}),c&&e.jsx(q,{children:c}),e.jsxs(Me,{...v(),children:[f.length>0&&e.jsx("span",{...k({"aria-label":d("new-request-form.cc-field.container-label","Selected CC emails")}),children:e.jsx("span",{ref:b,..._(),children:f.map(((n,t)=>{const r=De.test(n);return r?e.jsx(Ge,{...C(t),children:R(t,r,n)},t):e.jsx(W,{content:d("new-request-form.cc-field.invalid-email","Invalid email address"),children:e.jsx(Ge,{...C(t),children:R(t,r,n)})},t)}))})}),e.jsxs(Ae,{children:[e.jsx(He,{isBare:!0,"aria-hidden":"true",tabIndex:-1,children:p}),e.jsx(Xe,{ref:g,isBare:!0,...F()})]})]}),u&&e.jsx(y,{validation:"error",children:u}),f.map((n=>e.jsx("input",{type:"hidden",name:o,value:n},n))),e.jsx(P,{hidden:!0,...T(),children:I})]})}const Oe=r(P)`
  margin-left: ${e=>e.theme.space.xxs};
  font-weight: ${e=>e.theme.fontWeights.medium};
`;function Ue({field:n,onChange:r}){const{t:s}=t(),{label:a,error:o,value:i,name:l,required:c,description:d}=n,m=function(e){return e?e.replaceAll("X",""):""}(i);return e.jsxs(x,{children:[e.jsxs(w,{children:[a,c&&e.jsx(P,{"aria-hidden":"true",children:"*"}),e.jsx(Oe,{children:s("new-request-form.credit-card-digits-hint","(Last 4 digits)")})]}),d&&e.jsx(q,{dangerouslySetInnerHTML:{__html:d}}),e.jsx(I,{start:e.jsx(u,{}),name:l,type:"text",value:m,onChange:e=>r(e.target.value),validation:o?"error":void 0,required:c,maxLength:4,placeholder:"XXXX"}),o&&e.jsx(y,{validation:"error",children:o})]})}function Be({field:t,onChange:r}){const{label:s,options:a,error:o,value:i,name:l,required:u,description:c}=t,{currentGroup:d,isGroupIdentifier:m,setCurrentGroupByIdentifier:f}=ge({options:a,hasEmptyOption:!0}),h=i??"",[p,j]=n.useState(!1),g=n.useRef(null);n.useEffect((()=>{if(g.current&&u){const e=g.current.querySelector("[role=combobox]");e?.setAttribute("aria-required","true")}}),[g,u]);return e.jsxs(M,{children:[e.jsxs(G,{children:[s,u&&e.jsx(P,{"aria-hidden":"true",children:"*"})]}),c&&e.jsx(V,{dangerouslySetInnerHTML:{__html:c}}),e.jsxs(A,{ref:g,inputProps:{required:u,name:l},isEditable:!1,validation:o?"error":void 0,onChange:e=>{"string"==typeof e.selectionValue&&m(e.selectionValue)?f(e.selectionValue):("string"==typeof e.selectionValue&&r(e.selectionValue),void 0!==e.isExpanded&&j(e.isExpanded))},selectionValue:h,inputValue:h,renderValue:({selection:n})=>n?.label??e.jsx(ce,{}),isExpanded:p,children:["SubGroup"===d.type&&e.jsx(H,{...d.backOption}),"SubGroup"===d.type?e.jsx(N,{"aria-label":d.name,children:d.options.map((n=>e.jsx(H,{...n,children:n.menuLabel??n.label},n.value)))}):d.options.map((n=>""===n.value?e.jsx(H,{...n,children:e.jsx(ce,{})},n.value):e.jsx(H,{...n},n.value)))]}),o&&e.jsx(X,{validation:"error",children:o})]})}const We=c`
  from {
    grid-template-rows: 0fr;
  }
  to {
    grid-template-rows: 1fr;
  }
`,Ke=r.div`
  display: grid;
  animation: ${We} 200ms forwards;
`,Ye=r.div`
  overflow: hidden;
`,Je=r.ul`
  list-style: none;
  padding: 0;
  margin: 0;
`,Ze=r.li`
  margin: ${e=>e.theme.space.sm} 0;
`;function Qe({query:r,locale:s}){const a=function(e,t){const[r,s]=n.useState(e);return n.useEffect((()=>{const n=setTimeout((()=>s(e)),t);return()=>{clearTimeout(n)}}),[e,t]),r}(r,500),[o,i]=n.useState([]),l=n.useRef({}),{t:u}=t();return n.useEffect((()=>{const e=a?.trim().toLocaleLowerCase();if(!e||!function(e){const n=e.charCodeAt(0);return n>=19968&&n<=195103?e.length>=2:e.length>=3}(e))return void i([]);const n=new URL(`${window.location.origin}/api/v2/help_center/deflection/suggestions.json`);n.searchParams.append("locale",s),n.searchParams.append("query",e);const t=l.current[n.toString()];t?i(t):fetch(n).then((e=>e.json())).then((({results:e})=>{l.current[n.toString()]=e,i(e)}))}),[a,s]),o.length>0?e.jsx(Ke,{"data-test-id":"suggested-articles",children:e.jsxs(Ye,{children:[e.jsx("h2",{children:u("new-request-form.suggested-articles","Suggested articles")}),e.jsx(Je,{children:o.map((n=>e.jsx(Ze,{children:e.jsx(O,{href:n.html_url,children:n.name})},n.html_url)))})]})}):null}const en=r.h3`
  font-size: ${e=>e.theme.fontSizes.md};
  font-weight: ${e=>e.theme.fontWeights.bold};
`,nn=r(Q)`
  color: ${e=>Z("successHue",700,e.theme)};
`,tn=r(d)`
  position: absolute;
  top: ${e=>5.5*e.theme.space.base}px;
  inset-inline-start: ${e=>4*e.theme.space.base+"px"};
`,rn=r(O)`
  display: inline-block;
  margin-top: ${e=>e.theme.space.sm};
`;function sn({authToken:r,interactionAccessToken:s,articles:a,requestId:o,hasRequestManagement:i,isSignedIn:l,helpCenterPath:u,requestsPath:c,requestPath:d}){const[h,p]=n.useState(0),j=m(),{t:g}=t(),b=()=>String(a[h]?.article_id),x=()=>{f({type:"success",message:g("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")}),window.location.assign((()=>{if(l)return i?d:u;{const e=new URLSearchParams;return e.set("return_to",c),`${u}?${e.toString()}`}})())};return e.jsxs(ee,{appendToNode:j,onClose:()=>{x()},children:[e.jsxs(nn,{tag:"h2",children:[e.jsx(tn,{}),g("new-request-form.answer-bot-modal.request-submitted","Your request was successfully submitted")]}),e.jsxs(ne,{children:[e.jsx(en,{children:g("new-request-form.answer-bot-modal.title","While you wait, do any of these articles answer your question?")}),e.jsx("p",{children:g("new-request-form.answer-bot-modal.footer-content","If it does, we can close your recent request {{requestId}}",{requestId:`‭#${o}‬`})}),e.jsx(ae,{level:4,expandedSections:[h],onChange:e=>{p(e)},children:a.map((({article_id:n,html_url:t,snippet:s,title:a})=>e.jsxs(ae.Section,{children:[e.jsx(ae.Header,{children:e.jsx(ae.Label,{children:a})}),e.jsxs(ae.Panel,{children:[e.jsx(R,{dangerouslySetInnerHTML:{__html:s}}),e.jsx(rn,{isExternal:!0,href:`${t}?auth_token=${r}`,target:"_blank",children:g("new-request-form.answer-bot-modal.view-article","View article")})]})]},n)))})]}),e.jsxs(te,{children:[e.jsx(re,{children:e.jsx(U,{onClick:()=>{(async()=>{await fetch("/api/v2/answer_bot/rejection",{method:"POST",body:JSON.stringify({article_id:b(),interaction_access_token:s,reason_id:0}),headers:{"Content-Type":"application/json"}}),x()})()},children:g("new-request-form.answer-bot-modal.mark-irrelevant","No, I need help")})}),e.jsx(re,{children:e.jsx(U,{isPrimary:!0,onClick:()=>{(async()=>{(await fetch("/api/v2/answer_bot/resolution",{method:"POST",body:JSON.stringify({article_id:b(),interaction_access_token:s}),headers:{"Content-Type":"application/json"}})).ok?f({type:"success",message:g("new-request-form.answer-bot-modal.request-closed","Nice. Your request has been closed.")}):f({type:"error",message:g("new-request-form.answer-bot-modal.solve-error","There was an error closing your request")}),window.location.href=u})()},children:g("new-request-form.answer-bot-modal.solve-request","Yes, close my request")})})]}),e.jsx(se,{"aria-label":g("new-request-form.close-label","Close")})]})}const an=r(R)`
  margin: ${e=>e.theme.space.md} 0;
`,on=r.form`
  display: flex;
  flex-direction: column;
  gap: ${e=>e.theme.space.md};
`,ln=r.div`
  margin-top: ${e=>e.theme.space.md};
`;function un({requestForm:r,wysiwyg:s,newRequestPath:a,parentId:o,parentIdPath:i,locale:l,baseLocale:u,hasAtMentions:c,userRole:d,brandId:m,answerBotModal:f}){const{ticket_fields:h,action:p,http_method:j,accept_charset:g,errors:b,parent_id_field:x,ticket_form_field:w,email_field:q,cc_field:v,organization_field:y,due_date_field:k,end_user_conditions:_,attachments_field:C,inline_attachments_fields:S,description_mimetype_field:F}=r,{answerBot:T}=f,{ticketFields:I,emailField:P,ccField:R,organizationField:$,dueDateField:L}=Fe({ticketFields:h,emailField:q,ccField:v,organizationField:y,dueDateField:k}),[E,z]=n.useState(I),[M,G]=n.useState($),[V,A]=n.useState(L),H=Ee(E,_),{formRefCallback:X,handleSubmit:N}=ve(E),{t:B}=t();function W(e,n){z(E.map((t=>t.name===e.name?{...t,value:n}:t)))}return e.jsxs(e.Fragment,{children:[o&&e.jsx(an,{children:e.jsx(O,{href:i,children:B("new-request-form.parent-request-link","Follow-up to request {{parentId}}",{parentId:`‭#${o}‬`})})}),e.jsx(an,{"aria-hidden":"true",children:B("new-request-form.required-fields-info","Fields marked with an asterisk (*) are required.")}),e.jsxs(on,{ref:X,action:p,method:j,acceptCharset:g,noValidate:!0,onSubmit:N,children:[b&&e.jsx(D,{type:"error",children:b}),x&&e.jsx(qe,{field:x}),w.options.length>0&&e.jsx(we,{field:w,newRequestPath:a}),P&&e.jsx(oe,{field:P},P.name),R&&e.jsx(Ne,{field:R}),M&&e.jsx(de,{field:M,onChange:e=>{!function(e){null!==M&&G({...M,value:e})}(e)}},M.name),H.map((n=>{switch(n.type){case"subject":return e.jsxs(e.Fragment,{children:[e.jsx(oe,{field:n,onChange:e=>W(n,e)},n.name),e.jsx(Qe,{query:n.value,locale:l})]});case"text":case"integer":case"decimal":case"regexp":return e.jsx(oe,{field:n,onChange:e=>W(n,e)},n.name);case"partialcreditcard":return e.jsx(Ue,{field:n,onChange:e=>W(n,e)});case"description":return e.jsxs(e.Fragment,{children:[e.jsx(ue,{field:n,hasWysiwyg:s,baseLocale:u,hasAtMentions:c,userRole:d,brandId:m,onChange:e=>W(n,e)},n.name),e.jsx("input",{type:"hidden",name:F.name,value:s?"text/html":"text/plain"})]});case"textarea":return e.jsx(ue,{field:n,hasWysiwyg:!1,baseLocale:u,hasAtMentions:c,userRole:d,brandId:m,onChange:e=>W(n,e)},n.name);case"priority":case"basic_priority":case"tickettype":return e.jsxs(e.Fragment,{children:[e.jsx(de,{field:n,onChange:e=>W(n,e)},n.name),"task"===n.value&&e.jsx(ze,{field:V,locale:u,valueFormat:"dateTime",onChange:e=>{!function(e){null!==V&&A({...V,value:e})}(e)}})]});case"checkbox":return e.jsx(me,{field:n,onChange:e=>W(n,e)});case"date":return e.jsx(ze,{field:n,locale:u,valueFormat:"date",onChange:e=>W(n,e)});case"multiselect":return e.jsx(be,{field:n});case"tagger":return e.jsx(Be,{field:n,onChange:e=>W(n,e)},n.name);default:return e.jsx(e.Fragment,{})}})),C&&e.jsx(Re,{field:C}),S.map((({type:n,name:t,value:r},s)=>e.jsx("input",{type:n,name:t,value:r},s))),e.jsx(ln,{children:(0===w.options.length||w.value)&&e.jsx(U,{isPrimary:!0,type:"submit",children:B("new-request-form.submit","Submit")})})]}),T.auth_token&&T.interaction_access_token&&T.articles.length>0&&T.request_id&&e.jsx(sn,{authToken:T.auth_token,interactionAccessToken:T.interaction_access_token,articles:T.articles,requestId:T.request_id,...f})]})}async function cn(n,t,r){const{baseLocale:s}=t;h(s),await p(s,(()=>function(e){switch(e){case"./translations/locales/af.json":return import("new-request-form-translations").then((function(e){return e.a}));case"./translations/locales/ar-x-pseudo.json":return import("new-request-form-translations").then((function(e){return e.b}));case"./translations/locales/ar.json":return import("new-request-form-translations").then((function(e){return e.c}));case"./translations/locales/az.json":return import("new-request-form-translations").then((function(e){return e.d}));case"./translations/locales/be.json":return import("new-request-form-translations").then((function(e){return e.e}));case"./translations/locales/bg.json":return import("new-request-form-translations").then((function(e){return e.f}));case"./translations/locales/bn.json":return import("new-request-form-translations").then((function(e){return e.g}));case"./translations/locales/bs.json":return import("new-request-form-translations").then((function(e){return e.h}));case"./translations/locales/ca.json":return import("new-request-form-translations").then((function(e){return e.i}));case"./translations/locales/cs.json":return import("new-request-form-translations").then((function(e){return e.j}));case"./translations/locales/cy.json":return import("new-request-form-translations").then((function(e){return e.k}));case"./translations/locales/da.json":return import("new-request-form-translations").then((function(e){return e.l}));case"./translations/locales/de-x-informal.json":return import("new-request-form-translations").then((function(e){return e.m}));case"./translations/locales/de.json":return import("new-request-form-translations").then((function(e){return e.n}));case"./translations/locales/el.json":return import("new-request-form-translations").then((function(e){return e.o}));case"./translations/locales/en-001.json":return import("new-request-form-translations").then((function(e){return e.p}));case"./translations/locales/en-150.json":return import("new-request-form-translations").then((function(e){return e.q}));case"./translations/locales/en-au.json":return import("new-request-form-translations").then((function(e){return e.r}));case"./translations/locales/en-ca.json":return import("new-request-form-translations").then((function(e){return e.s}));case"./translations/locales/en-gb.json":return import("new-request-form-translations").then((function(e){return e.t}));case"./translations/locales/en-my.json":return import("new-request-form-translations").then((function(e){return e.u}));case"./translations/locales/en-ph.json":return import("new-request-form-translations").then((function(e){return e.v}));case"./translations/locales/en-se.json":return import("new-request-form-translations").then((function(e){return e.w}));case"./translations/locales/en-us.json":return import("new-request-form-translations").then((function(e){return e.x}));case"./translations/locales/en-x-dev.json":return import("new-request-form-translations").then((function(e){return e.y}));case"./translations/locales/en-x-keys.json":return import("new-request-form-translations").then((function(e){return e.z}));case"./translations/locales/en-x-obsolete.json":return import("new-request-form-translations").then((function(e){return e.A}));case"./translations/locales/en-x-pseudo.json":return import("new-request-form-translations").then((function(e){return e.B}));case"./translations/locales/en-x-test.json":return import("new-request-form-translations").then((function(e){return e.C}));case"./translations/locales/es-419.json":return import("new-request-form-translations").then((function(e){return e.D}));case"./translations/locales/es-es.json":return import("new-request-form-translations").then((function(e){return e.E}));case"./translations/locales/es.json":return import("new-request-form-translations").then((function(e){return e.F}));case"./translations/locales/et.json":return import("new-request-form-translations").then((function(e){return e.G}));case"./translations/locales/eu.json":return import("new-request-form-translations").then((function(e){return e.H}));case"./translations/locales/fa-af.json":return import("new-request-form-translations").then((function(e){return e.I}));case"./translations/locales/fa.json":return import("new-request-form-translations").then((function(e){return e.J}));case"./translations/locales/fi.json":return import("new-request-form-translations").then((function(e){return e.K}));case"./translations/locales/fil.json":return import("new-request-form-translations").then((function(e){return e.L}));case"./translations/locales/fo.json":return import("new-request-form-translations").then((function(e){return e.M}));case"./translations/locales/fr-ca.json":return import("new-request-form-translations").then((function(e){return e.N}));case"./translations/locales/fr.json":return import("new-request-form-translations").then((function(e){return e.O}));case"./translations/locales/ga.json":return import("new-request-form-translations").then((function(e){return e.P}));case"./translations/locales/he.json":return import("new-request-form-translations").then((function(e){return e.Q}));case"./translations/locales/hi.json":return import("new-request-form-translations").then((function(e){return e.R}));case"./translations/locales/hr.json":return import("new-request-form-translations").then((function(e){return e.S}));case"./translations/locales/hu.json":return import("new-request-form-translations").then((function(e){return e.T}));case"./translations/locales/hy.json":return import("new-request-form-translations").then((function(e){return e.U}));case"./translations/locales/id.json":return import("new-request-form-translations").then((function(e){return e.V}));case"./translations/locales/is.json":return import("new-request-form-translations").then((function(e){return e.W}));case"./translations/locales/it-ch.json":return import("new-request-form-translations").then((function(e){return e.X}));case"./translations/locales/it.json":return import("new-request-form-translations").then((function(e){return e.Y}));case"./translations/locales/ja.json":return import("new-request-form-translations").then((function(e){return e.Z}));case"./translations/locales/ka.json":return import("new-request-form-translations").then((function(e){return e._}));case"./translations/locales/kk.json":return import("new-request-form-translations").then((function(e){return e.$}));case"./translations/locales/kl-dk.json":return import("new-request-form-translations").then((function(e){return e.a0}));case"./translations/locales/ko.json":return import("new-request-form-translations").then((function(e){return e.a1}));case"./translations/locales/ku.json":return import("new-request-form-translations").then((function(e){return e.a2}));case"./translations/locales/lt.json":return import("new-request-form-translations").then((function(e){return e.a3}));case"./translations/locales/lv.json":return import("new-request-form-translations").then((function(e){return e.a4}));case"./translations/locales/mk.json":return import("new-request-form-translations").then((function(e){return e.a5}));case"./translations/locales/mn.json":return import("new-request-form-translations").then((function(e){return e.a6}));case"./translations/locales/ms.json":return import("new-request-form-translations").then((function(e){return e.a7}));case"./translations/locales/mt.json":return import("new-request-form-translations").then((function(e){return e.a8}));case"./translations/locales/my.json":return import("new-request-form-translations").then((function(e){return e.a9}));case"./translations/locales/nl-be.json":return import("new-request-form-translations").then((function(e){return e.aa}));case"./translations/locales/nl.json":return import("new-request-form-translations").then((function(e){return e.ab}));case"./translations/locales/no.json":return import("new-request-form-translations").then((function(e){return e.ac}));case"./translations/locales/pl.json":return import("new-request-form-translations").then((function(e){return e.ad}));case"./translations/locales/pt-br.json":return import("new-request-form-translations").then((function(e){return e.ae}));case"./translations/locales/pt.json":return import("new-request-form-translations").then((function(e){return e.af}));case"./translations/locales/ro.json":return import("new-request-form-translations").then((function(e){return e.ag}));case"./translations/locales/ru.json":return import("new-request-form-translations").then((function(e){return e.ah}));case"./translations/locales/sk.json":return import("new-request-form-translations").then((function(e){return e.ai}));case"./translations/locales/sl.json":return import("new-request-form-translations").then((function(e){return e.aj}));case"./translations/locales/sq.json":return import("new-request-form-translations").then((function(e){return e.ak}));case"./translations/locales/sr-me.json":return import("new-request-form-translations").then((function(e){return e.al}));case"./translations/locales/sr.json":return import("new-request-form-translations").then((function(e){return e.am}));case"./translations/locales/sv.json":return import("new-request-form-translations").then((function(e){return e.an}));case"./translations/locales/th.json":return import("new-request-form-translations").then((function(e){return e.ao}));case"./translations/locales/tr.json":return import("new-request-form-translations").then((function(e){return e.ap}));case"./translations/locales/uk.json":return import("new-request-form-translations").then((function(e){return e.aq}));case"./translations/locales/ur.json":return import("new-request-form-translations").then((function(e){return e.ar}));case"./translations/locales/uz.json":return import("new-request-form-translations").then((function(e){return e.as}));case"./translations/locales/vi.json":return import("new-request-form-translations").then((function(e){return e.at}));case"./translations/locales/zh-cn.json":return import("new-request-form-translations").then((function(e){return e.au}));case"./translations/locales/zh-tw.json":return import("new-request-form-translations").then((function(e){return e.av}));default:return new Promise((function(n,t){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`./translations/locales/${s}.json`))),j.render(e.jsx(g,{theme:b(n),children:e.jsx(un,{...t})}),r)}export{cn as renderNewRequestForm};
